$(document).ready(function(){function e(e){l(),t(e)}function t(e){switch(I=e,e){case B.BOUNDING_BOX_RECTANGLE:g=new google.maps.Rectangle({bounds:{north:60,south:40,east:16,west:-4},strokeColor:"#2E6C77",strokeOpacity:.8,strokeWeight:2,fillColor:"#2E6C77",fillOpacity:.15,draggable:!0,editable:!0,geodesic:!0,map:_}),m.setQueryParameter("insideBoundingBox",f(g)),w.push(google.maps.event.addListener(g,"bounds_changed",y(n,150)));break;case B.AROUND_IP:m.setQueryParameter("aroundLatLngViaIP",!0)}k=!0,m.search()}function l(){g&&g.setMap(null);for(var e=0;e<w.length;++e)google.maps.event.removeListener(w[e]);w=[],h.val(""),m.setQuery(""),m.setQueryParameter("insideBoundingBox",undefined),m.setQueryParameter("aroundLatLngViaIP",undefined)}function a(e){if(0!==e.hits.length){e.hits=e.hits.slice(0,5);for(var t=0;t<e.hits.length;++t){var l=e.hits[t];l._rankingInfo.matchedGeoLocation&&(l.distance=parseInt(l._rankingInfo.matchedGeoLocation.distance/1e3,10)+" km")}T.html(v.render(e))}else T.html(b.render())}function r(e){function t(e,t){var l=new google.maps.InfoWindow({content:'<a href="'+t.url+'"><h4 class="ui small header">'+t.title+'<div class="sub header"><em>'+t.collection+" in "+t.city+"</em></div></h4></a>"});e.addListener("click",function(){l.open(_,e)})}s(),x=[];for(var l=0;l<e.hits.length;++l){var a=e.hits[l],r=new google.maps.Marker({position:{lat:a._geoloc.lat,lng:a._geoloc.lng},map:_,icon:L,title:a.title});x.push(r),t(r,a)}k&&i()}function o(e,t){$(".change_page_state").removeClass("active"),$('.change_page_state[data-state="'+e+'"]').addClass("active"),$(".page_mode").removeClass("active"),$('.page_mode[data-mode="'+t+'"]').addClass("active")}function i(){for(var e=new google.maps.LatLngBounds,t=0;t<x.length;t++)e.extend(x[t].getPosition());_.fitBounds(e)}function s(){for(var e=0;e<x.length;e++)x[e].setMap(null)}function n(){k=!1,m.setQueryParameter("insideBoundingBox",f(g)).search()}function f(e){var t=e.getBounds(),l=t.getNorthEast(),a=t.getSouthWest();return[l.lat(),l.lng(),a.lat(),a.lng()].join()}function y(e,t){function l(){s=Date.now(),i=null,o=e.apply(a,r),i||(a=r=null)}var a,r,o,i=null,s=0;return function(){var n=Date.now(),f=t-(n-s);return a=this,r=arguments,f<=0||f>t?(i&&(clearTimeout(i),i=null),s=n,o=e.apply(a,r),i||(a=r=null)):i||(i=setTimeout(l,f)),o}}var p="diybiosphere",c={hitsPerPage:100},u=algoliasearch("ITI5JHZJM9","b427318cf6d881e5d3ffd84adf39219e"),m=algoliasearchHelper(u,p,c);m.setQueryParameter("getRankingInfo",!0);var g,d=$("#map"),T=$("#hits"),h=$("#search-input"),v=Hogan.compile($("#hits-template").text()),b=Hogan.compile($("#no-results-template").text()),_=new google.maps.Map(d.get(0),{streetViewControl:!1,zoom:4,minZoom:1,maxZoom:12,styles:[{elementType:"geometry",stylers:[{color:"#212121"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{elementType:"labels.text.stroke",stylers:[{color:"#212121"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#757575"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#ffffff"},{visibility:"on"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{color:"#ffffff"},{visibility:"on"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{color:"#ffffff"},{visibility:"on"}]},{featureType:"administrative.province",elementType:"labels.text.fill",stylers:[{color:"#ffffff"},{visibility:"on"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#000000"},{visibility:"on"}]},{featureType:"poi",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#181818"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"poi.park",elementType:"labels.text.stroke",stylers:[{color:"#1b1b1b"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#2c2c2c"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#8a8a8a"}]},{featureType:"road.arterial",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#373737"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#3c3c3c"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#4e4e4e"}]},{featureType:"road.local",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#ffffff"},{visibility:"on"}]},{featureType:"water",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#000000"},{visibility:"on"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{visibility:"on"}]}]}),k=!0,x=[],w=[],B={LOAD:0,BOUNDING_BOX_RECTANGLE:1,AROUND_IP:4},I=B.LOAD;e(B.AROUND_IP),h.on("input propertychange",function(e){var t=e.currentTarget.value;I===B.BOUNDING_BOX_RECTANGLE&&(k=!1),m.setQuery(t).search()}),m.on("result",function(e){r(e),a(e)}),m.on("error",function(e){console.log(e)});var L="https://ibin.co/3Vj6FWizYk7k.png";$(".change_page_state").on("click",function(t){switch(t.preventDefault(),o($(this).data("state"),$(this).data("mode")),$(this).data("state")){case"rectangle":e(B.BOUNDING_BOX_RECTANGLE);break;case"ip":e(B.AROUND_IP)}})});