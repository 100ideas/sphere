$(document).ready(function(){function e(e){l(),t(e)}function t(e){switch(N=e,e){case L.BOUNDING_BOX_RECTANGLE:T=new google.maps.Rectangle({bounds:{north:60,south:40,east:16,west:-4},strokeColor:"#2E6C77",strokeOpacity:.8,strokeWeight:2,fillColor:"#2E6C77",fillOpacity:.15,draggable:!0,editable:!0,geodesic:!0,map:x}),g.setQueryParameter("insideBoundingBox",f(T)),I.push(google.maps.event.addListener(T,"bounds_changed",y(n,150)));break;case L.AROUND_IP:g.setQueryParameter("aroundLatLngViaIP",!0)}w=!0,g.search()}function l(){T&&T.setMap(null);for(var e=0;e<I.length;++e)google.maps.event.removeListener(I[e]);I=[],b.val(""),g.setQuery(""),g.setQueryParameter("insideBoundingBox",undefined),g.setQueryParameter("aroundLatLngViaIP",undefined)}function a(e){if(0===e.hits.length)return void h.html(k.render());e.hits=e.hits.slice(0,5);for(var t=0;t<e.hits.length;++t){var l=e.hits[t];l._rankingInfo.matchedGeoLocation&&(l.distance=parseInt(l._rankingInfo.matchedGeoLocation.distance/1e3,10)+" km")}h.html(_.render(e))}function r(e){function t(e,t){var l=new google.maps.InfoWindow({content:'<a href="'+t.url+'"><h4 class="ui small header">'+t.title+'<div class="sub header"><em>'+t.collection+" in "+t.city+"</em></div></h4></a>"});e.addListener("click",function(){l.open(x,e)})}s(),B=[];for(var l=0;l<e.hits.length;++l){var a=e.hits[l],r=new google.maps.Marker({position:{lat:a._geoloc.lat,lng:a._geoloc.lng},map:x,icon:O,title:a.title});B.push(r),t(r,a)}w&&i()}function o(e,t){$(".change_page_state").removeClass("active"),$('.change_page_state[data-state="'+e+'"]').addClass("active"),$(".page_mode").removeClass("active"),$('.page_mode[data-mode="'+t+'"]').addClass("active")}function i(){for(var e=new google.maps.LatLngBounds,t=0;t<B.length;t++)e.extend(B[t].getPosition());x.fitBounds(e)}function s(){for(var e=0;e<B.length;e++)B[e].setMap(null)}function n(){w=!1,g.setQueryParameter("insideBoundingBox",f(T)).search()}function f(e){var t=e.getBounds(),l=t.getNorthEast(),a=t.getSouthWest();return[l.lat(),l.lng(),a.lat(),a.lng()].join()}function y(e,t){function l(){s=Date.now(),i=null,o=e.apply(a,r),i||(a=r=null)}var a,r,o,i=null,s=0;return function(){var n=Date.now(),f=t-(n-s);return a=this,r=arguments,f<=0||f>t?(i&&(clearTimeout(i),i=null),s=n,o=e.apply(a,r),i||(a=r=null)):i||(i=setTimeout(l,f)),o}}var p="ITI5JHZJM9",c="b427318cf6d881e5d3ffd84adf39219e",u="diybiosphere",m={hitsPerPage:100},d=algoliasearch(p,c),g=algoliasearchHelper(d,u,m);g.setQueryParameter("getRankingInfo",!0);var T,v=$("#map"),h=$("#hits"),b=$("#search-input"),_=Hogan.compile($("#hits-template").text()),k=Hogan.compile($("#no-results-template").text()),x=new google.maps.Map(v.get(0),{streetViewControl:!1,zoom:4,minZoom:1,maxZoom:12,styles:[{elementType:"geometry",stylers:[{color:"#212121"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{elementType:"labels.text.stroke",stylers:[{color:"#212121"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#757575"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#ffffff"},{visibility:"on"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{color:"#ffffff"},{visibility:"on"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{color:"#ffffff"},{visibility:"on"}]},{featureType:"administrative.province",elementType:"labels.text.fill",stylers:[{color:"#ffffff"},{visibility:"on"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#000000"},{visibility:"on"}]},{featureType:"poi",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#181818"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"poi.park",elementType:"labels.text.stroke",stylers:[{color:"#1b1b1b"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#2c2c2c"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#8a8a8a"}]},{featureType:"road.arterial",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#373737"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#3c3c3c"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#4e4e4e"}]},{featureType:"road.local",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#ffffff"},{visibility:"on"}]},{featureType:"water",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#000000"},{visibility:"on"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{visibility:"on"}]}]}),w=!0,B=[],I=[],L={LOAD:0,BOUNDING_BOX_RECTANGLE:1,AROUND_IP:4},N=L.LOAD;e(L.AROUND_IP),b.on("input propertychange",function(e){var t=e.currentTarget.value;N===L.BOUNDING_BOX_RECTANGLE&&(w=!1),g.setQuery(t).search()}),g.on("result",function(e){r(e),a(e)}),g.on("error",function(e){console.log(e)});var O="https://ibin.co/3Vj6FWizYk7k.png";$(".change_page_state").on("click",function(t){switch(t.preventDefault(),o($(this).data("state"),$(this).data("mode")),$(this).data("state")){case"rectangle":e(L.BOUNDING_BOX_RECTANGLE);break;case"ip":e(L.AROUND_IP)}})});